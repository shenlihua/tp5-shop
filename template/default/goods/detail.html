{extend name="base"/}

{block name="content"}
{include file="common/header"/}

<!--广告块-->
<div class="layui-main layui-main-width main-content">


    <!--产品 详情-->
    <div class="goods-detail">
        <div class="goods-img">
            <div class="img">
                <img src="{:get_image_location($goods_info['cover_img'])}" alt="{$goods_info['name']}">
            </div>
        </div>
        <div class="goods-info">
            <div class="goods-name">{$goods_info['name']}</div>
            <div class="sold-info">
                <div class="info">
                    <span class="ship">商城价</span>
                    <em class="price">￥0.00</em>

                </div>
                <div class="num">
                    <em class="view-num">0</em>
                    <em class="sold-num">0</em>
                </div>
            </div>
            <div class="info-item">
                {volist name="property" id="vo"}
                <div class="item">
                    <div class="ship">{$vo['name']}</div>
                    <div class="content">
                        <ul>
                            {volist name="vo['data']"  id="prop"}
                            <li class="" data-attr_id="{$prop['id']}"><a href="##"  ><b></b>{$prop['name']}</a></li>
                            {/volist}

                        </ul>
                    </div>
                </div>
                {/volist}
                <div class="item">
                    <div class="ship">数量</div>
                    <div class="content">
                        <div class="amount-warp">
                            <input class="text buy-num" ectype="quantity" onblur="changePrice()" value="0" name="number" defaultnumber="1">
                            <div class="a-btn">
                                <a href="javascript:void(0);" class="btn-add"><i class="layui-icon layui-icon-up"></i></a>
                                <a href="javascript:void(0);" class="btn-reduce btn-disabled"><i class="layui-icon layui-icon-down"></i></a>
                                <input type="hidden" ectype="perNumber" value="1000">
                                <input type="hidden" ectype="perMinNumber" value="1">
                            </div>
                            <input name="confirm_type" id="confirm_type" type="hidden" value="3">
                        </div>
                    </div>
                </div>
            </div>
            <div class="goods-btn">
                <button type="button" class="buy">立即购买</button>
                <button type="button" class="cart"><i class="layui-icon layui-icon-cart"></i>加入购物车</button>
            </div>
        </div>

    </div>

    <div class="goods-coll">
        <a href="##" class="coll-btn"><i class="layui-icon layui-icon-rate"></i>  <em>收藏</em></a>
        <a href="##" class="share-btn"><i class="layui-icon layui-icon-share"></i>  <em>分享</em></a>
    </div>
    <div class="goods-other">
        <div class="goods-hot">
            <div class="title">
                热门推荐
            </div>
            <ul class="list">
                <li>
                    <a href="###">
                        <img src="/static/images/s-02.png" alt="">
                        <p class="name">xxxxxxxxxxxxxxxxx</p>
                        <p class="price"><i>￥</i><em>199.99</em></p>
                    </a>
                </li>
                <li>
                    <a href="###">
                        <img src="#" alt="">
                        <p class="name">xxxxxxxxxxxxxxxxx</p>
                        <p class="price"><i>￥</i><em>199.99</em></p>
                    </a>
                </li>
                <li>
                    <a href="###">
                        <img src="#" alt="">
                        <p class="name">xxxxxxxxxxxxxxxxx</p>
                        <p class="price"><i>￥</i><em>199.99</em></p>
                    </a>
                </li>
            </ul>
        </div>
        <div class="goods-detail">
            <div class="layui-tab ">
                <ul class="layui-tab-title">
                    <li class="layui-this">商品详情</li>
                    <li>规格参数</li>
                </ul>
                <div class="layui-tab-content">
                    <div class="layui-tab-item layui-show">内容1</div>
                    <div class="layui-tab-item">内容2</div>
                </div>
            </div>
        </div>
    </div>
</div>



{include file="common/footer"/}
{/block}
{block name="script"}
<script>
    //属性集合
    var goods_attr = '{:json_encode($goods_info["link_price"],true)}';
    goods_attr = JSON.parse(goods_attr)
    var attr_k_v={};
    //选择的属性
    var attr_id=0;
    //商品选中的属性
    var choose_attr_info={};
    $(function(){
        $(".info-item ul li a").click(function(){
            if(!$(this).parent().hasClass('active')) {
                $(this).parent().parent().find('li.active').removeClass('active')
                $(this).parent().addClass('active')
            }
        })

        $(".goods-info .goods-btn .buy").click(function(){
            var attr=[];
            $(".info-item ul li.active").each(function(index){
                attr.push($(this).data('attr_id'))
            })
            attr = attr.sort()
            var group = attr.join('|')
            // get_attr_id(group)
            window.location.href="{:url('order',['gid'=>$goods_info['id']],false,false)}/attr_id/"+get_attr_id(group)
        })



    })

    init_data()

    function init_data(index) {
        var index = index?index:0;
        var data;
        for(var i=0;i<goods_attr.length;i++) {
            if(goods_attr[i].id==index){
                console.log(goods_attr[i])
                data = goods_attr[i]
            }
            var attr_info = goods_attr[i].attr_info;
            attr_info = attr_info.sort()
            attr_info = attr_info.join('|')
            attr_k_v[attr_info] = goods_attr[i].id
        }

        if(!data) {
            data = goods_attr[0];
        }
        choose_attr_info = data;

        handle_price()
    }

    //处理商品价格
    function handle_price()
    {
        //处理价格
        $(".sold-info .info .price").text('￥'+choose_attr_info.price)
        choose_attr_info.attr_info.map(function(value,index){
            $(".info-item ul [data-attr_id='"+value+"']").addClass('active')
        })
    }


    //获取选择的属性
    function get_attr_id(group)
    {
        return attr_k_v[group]
    }
</script>
{/block}